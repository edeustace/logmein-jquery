(function(){window.com||(window.com={});com.ee||(com.ee={});this.com.ee.LogMeIn=(function(){function a(f,d){var b,c,h,g,e;e=Math.floor(Math.random()*10000);console.log(e);this.ENTER=13;this.TAB=9;g='<input id=\'username\' type="text" value="username"></input>\n<input id=\'password\' type="password" value="password"></input>';this.$element=$(f);c=function(i){return i+"_"+Math.floor(Math.random()*1000)};this._logoutUid=c("logout");this._messageUid=c("message");b={buildParams:this._buildParams,loginCallback:this._loginCallback,logoutCallback:this._logoutCallback,isLoggedIn:false,template:g,loginLabel:"login",logoutLabel:"logout",errorTemplate:"<span><br/>${message}</span>"};this.config=d!=null?$.extend(b,d):b;h=function(i){var j;j=i.match(/type="text" value="(.*?)"/);return j[1]};this.usernameValue=h(this.config.template);console.log("username value: "+this.usernameValue);if(this.config.isLoggedIn){this.addLogoutLink()}else{this.addusernameLink()}}a.prototype.showError=function(b){var c;c=this.config.errorTemplate.replace("${message}",b);c="<span id='errorMessage'>"+c+"</span>";this.$element.append($(c));return null};a.prototype._removeError=function(){this.$element.find("#errorMessage").remove();return null};a.prototype.addusernameLink=function(){return this._addLinkAndCallback(this._loginUid,this.config.loginLabel,this._onLoginClick)};a.prototype._onLoginClick=function(b){var c;this.addInputs();c=this.$element.find("#username");c.focus();c.attr("value","");return null};a.prototype._loginCallback=function(b){var c,d;c=this._parseResponse(b);if(c.status!=="success"){d=c.msg!=null?c.msg:"An unknown error occured";this.showError(d);return}this.addLogoutLink();return null};a.prototype.addLogoutLink=function(){this._addLinkAndCallback(this._logoutUid,"logout",this._onLogoutClick);return null};a.prototype._onLogoutClick=function(){var b=this;$.get(this.config.logoutUrl+("?_ck="+(Math.random())),function(c){return b.config.logoutCallback.call(b,c)});return null};a.prototype._addLinkAndCallback=function(c,b,f){var d,e=this;if(!(f!=null)){throw"callback not defined"}d='<a id="'+c+'" href="javascript:void(0)">'+b+"</a>";this.$element.html(d);this.$element.find("#"+c).click(function(g){return f.call(e,g)});return null};a.prototype._logoutCallback=function(b){var c;c=this._parseResponse(b);if(c.status==="success"){this.addusernameLink()}return null};a.prototype._parseResponse=function(b){if(typeof b==="string"){return $.parseJSON(b)}else{return b}};a.prototype.addInputs=function(){var b,d,c,e,f=this;c=function(g){return g.replace(/type=["|']password["|']/g,'type="text" ')};e=c(this.config.template);this.$element.html(e);d=this.$element.find("#username");d.click(function(){if($(this).attr("value")===this.usernameValue){$(this).attr("value","")}return null}).keydown(function(g){f._removeError();if(f._keyCodeMatches(f.TAB,g)){g.preventDefault();setTimeout((function(){return f._convertPasswordInput()}),100)}return null});b=this.$element.find("#password");b.click(function(){return setTimeout((function(){return f._convertPasswordInput()}),100)});return null};a.prototype._buildParams=function(c,b){return{username:c,password:b}};a.prototype._login=function(){var c,b,e,d=this;e=this.$element.find("#username").attr("value");b=this.$element.find("#password").attr("value");c=this.config.buildParams(e,b);if(!(this.config.loginUrl!=null)){throw"no login url provided"}$.post(this.config.loginUrl,c,function(f){return d.config.loginCallback.call(d,f)});return null};a.prototype._convertPasswordInput=function(){var g,b,e,d,c,f=this;g=this.$element.find("#password");if(g.attr("type")==="password"){g.focus();return}d=function(h){return h.replace(/type=["|']text["|'']/,'type="password" ')};c=g.clone().wrap("<div>").parent().html();e=d(c);$(e).insertAfter(g);g.remove();b=this.$element.find("#password");b.focus();b.keydown(function(h){f._removeError();if(f._keyCodeMatches(f.ENTER,h)){f._login()}return null});return null};a.prototype._keyCodeMatches=function(c,b){return b.keyCode===c||b.which===c};return a})();jQuery.fn.logMeIn=function(a){this.each(function(b){console.log(this);new com.ee.LogMeIn(this,a);return null});return this}}).call(this);